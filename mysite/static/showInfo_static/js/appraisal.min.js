function getDateTime(){var a=new Date();var b=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate()+" "+a.getHours()+":"+a.getMinutes()+":"+a.getSeconds();return b}function showAppraisal(c,b,a){$.getJSON("/foodtrace/getallscore/?time="+getDateTime(),{food_name:c,enterprise_name:b,currentpage:a},function(h){if(h.result==""||h.result==null){var e="<span id='scorerate'><a class='evaluate'> </a></span>";$("#scorerate").replaceWith(e);var j="<div id='evaul'><div class='comment'><div class='user'><a>暂无该类产品的评论</a></div></div></div>";$("#evaul").replaceWith(j)}else{var m="<span id='scorerate'>好评率:&nbsp;<a class='evaluate'>"+((h.Good/h.TotalScore)*100).toFixed(1)+"%</a></br>好评数:&nbsp;<a class='evaluate'>"+h.Good+"</a></br>差评数:&nbsp;<a class='evaluate'>"+(h.TotalScore-h.Good)+"</a></span>";$("#scorerate").replaceWith(m);var g=h.result;var d="<div id='evaul'></div>";$("#evaul").replaceWith(d);$.each(g,function(p,q){var o=q.user;var r=q.time;var s=q.score;var n=q.appraisal;showDetail(o,r,s,n)});var l=h.totalpages;var f=5;var k=pageBar(l,a,f,c,b);var i="<div id='mapages'>&nbsp;&nbsp;&nbsp;&nbsp;"+k+"</div>";$("#mapages").replaceWith(i)}})}function showDetail(b,e,f,a){if(f==1){var c="<img src='/site_static/foodtrace_static/images/up.png' alt=' '>"}else{c="<img src='/site_static/foodtrace_static/images/down.png' alt=' '>"}var d="<div class='comment'><div class='user'><a>"+b+"</a>"+c+"</div><div class='time'><a>"+e+"</a></div><div class='message'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<p>"+a+"</p></div><div class='cutoffs'></div></div>";$("#evaul").append(d)}function pageBar(m,l,b,h,n){var d="";if(m>1&&l>1){var c=l-1;d+="<a href=\"javascript:showAppraisal('"+h+"','"+n+"','"+c+"')\">上一页 </a>&nbsp;&nbsp;&nbsp;&nbsp;"}else{d+='<a href="javascript:void(0);">上一页</a>&nbsp;&nbsp;&nbsp;&nbsp;'}if(m>1){if(l==1){d+="1&nbsp;&nbsp;&nbsp;&nbsp;"}else{d+="<a href=\"javascript:showAppraisal('"+h+"','"+n+"','"+1+"')\">1 </a>&nbsp;&nbsp;&nbsp;&nbsp;"}if(m>2){var j=Math.floor(b/2);var p=l-j;if(p<=1){p=2}var k=l+j;if(k>=m){k=m-1}if(p<=(1+j)){if(m>(b+2)){k=p+(b-1);if(k>=m){k=m-1}}else{p=2}}if(k>=(m-j)){if(m>(b+2)){p=k-(b-1);if(p<=1){p=2}}else{k=m-1}}if(k<p){k=p}if(p>2){var a=l-b;if(a<1){a=1}d+="<a href=\"javascript:showAppraisal('"+h+"','"+n+"','"+a+"')\"> …  </a>&nbsp;&nbsp;&nbsp;&nbsp;"}for(var f=p;f<=k;f++){if(f==l){d+=" "+f+" &nbsp;&nbsp;&nbsp;&nbsp;"}else{d+="<a href=\"javascript:showAppraisal('"+h+"','"+n+"','"+f+"')\"> "+f+"  </a>&nbsp;&nbsp;&nbsp;&nbsp;"}}if(k<(m-1)){var o=l+b;if(o>m){o=m}d+="<a href=\"javascript:showAppraisal('"+h+"','"+n+"','"+o+"')\"> …  </a>&nbsp;&nbsp;&nbsp;&nbsp;"}}if(l==m){d+=" "+m+" &nbsp;&nbsp;&nbsp;&nbsp;"}else{d+="<a href=\"javascript:showAppraisal('"+h+"','"+n+"','"+m+"')\"> "+m+" </a>&nbsp;&nbsp;&nbsp;&nbsp;"}}else{d+='<a href="javascript:void(0);"> '+1+" </a>&nbsp;&nbsp;&nbsp;&nbsp;"}if(m>1&&l<m){var g=parseInt(l)+1;d+="<a href=\"javascript:showAppraisal('"+h+"','"+n+"','"+g+"')\"> 下一页  </a>&nbsp;&nbsp;&nbsp;&nbsp;"}else{d+='<a href="javascript:void(0);"> 下一页  </a>&nbsp;&nbsp;&nbsp;&nbsp;'}return d}function showAppraisalByCode(c,a,b){$.getJSON("/foodtrace/getallscoreByCode/?time="+getDateTime(),{itemCode:c,locaCode:a,currentpage:b},function(h){if(h.result==""||h.result==null){var e="<span id='scorerate'><a class='evaluate'> </a></span>";$("#scorerate").replaceWith(e);var j="<div id='evaul'><div class='comment'><div class='user'><a>暂无该类产品的评论</a></div></div></div>";$("#evaul").replaceWith(j)}else{var m="<span id='scorerate'>好评率:&nbsp;<a class='evaluate'>"+((h.Good/h.TotalScore)*100).toFixed(1)+"%</a></br>好评数:&nbsp;<a class='evaluate'>"+h.Good+"</a></br>差评数:&nbsp;<a class='evaluate'>"+(h.TotalScore-h.Good)+"</a></span>";$("#scorerate").replaceWith(m);var g=h.result;var d="<div id='evaul'></div>";$("#evaul").replaceWith(d);$.each(g,function(p,q){var o=q.user;var r=q.time;var s=q.score;var n=q.appraisal;showDetail(o,r,s,n)});var l=h.totalpages;var f=5;var k=pageBarByCode(l,b,f,c,a);var i="<div id='mapages'>&nbsp;&nbsp;&nbsp;&nbsp;"+k+"</div>";$("#mapages").replaceWith(i)}})}function pageBarByCode(n,m,d,a,c){var g="";if(n>1&&m>1){var f=m-1;g+="<a href=\"javascript:showAppraisal('"+a+"','"+c+"','"+f+"')\">上一页 </a>&nbsp;&nbsp;&nbsp;&nbsp;"}else{g+='<a href="javascript:void(0);">上一页</a>&nbsp;&nbsp;&nbsp;&nbsp;'}if(n>1){if(m==1){g+="1&nbsp;&nbsp;&nbsp;&nbsp;"}else{g+="<a href=\"javascript:showAppraisal('"+a+"','"+c+"','"+1+"')\">1 </a>&nbsp;&nbsp;&nbsp;&nbsp;"}if(n>2){var k=Math.floor(d/2);var p=m-k;if(p<=1){p=2}var l=m+k;if(l>=n){l=n-1}if(p<=(1+k)){if(n>(d+2)){l=p+(d-1);if(l>=n){l=n-1}}else{p=2}}if(l>=(n-k)){if(n>(d+2)){p=l-(d-1);if(p<=1){p=2}}else{l=n-1}}if(l<p){l=p}if(p>2){var b=m-d;if(b<1){b=1}g+="<a href=\"javascript:showAppraisal('"+a+"','"+c+"','"+b+"')\"> …  </a>&nbsp;&nbsp;&nbsp;&nbsp;"}for(var h=p;h<=l;h++){if(h==m){g+=" "+h+" &nbsp;&nbsp;&nbsp;&nbsp;"}else{g+="<a href=\"javascript:showAppraisal('"+a+"','"+c+"','"+h+"')\"> "+h+"  </a>&nbsp;&nbsp;&nbsp;&nbsp;"}}if(l<(n-1)){var o=m+d;if(o>n){o=n}g+="<a href=\"javascript:showAppraisal('"+a+"','"+c+"','"+o+"')\"> …  </a>&nbsp;&nbsp;&nbsp;&nbsp;"}}if(m==n){g+=" "+n+" &nbsp;&nbsp;&nbsp;&nbsp;"}else{g+="<a href=\"javascript:showAppraisal('"+a+"','"+c+"','"+n+"')\"> "+n+" </a>&nbsp;&nbsp;&nbsp;&nbsp;"}}else{g+='<a href="javascript:void(0);"> '+1+" </a>&nbsp;&nbsp;&nbsp;&nbsp;"}if(n>1&&m<n){var j=parseInt(m)+1;g+="<a href=\"javascript:showAppraisal('"+a+"','"+c+"','"+j+"')\"> 下一页  </a>&nbsp;&nbsp;&nbsp;&nbsp;"}else{g+='<a href="javascript:void(0);"> 下一页  </a>&nbsp;&nbsp;&nbsp;&nbsp;'}return g};